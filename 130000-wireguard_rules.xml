<group name="wireguard,">

  <rule id="130000" level="0">
    <decoded_as>wireguard-parent</decoded_as>
    <description>WireGuard event grouped.</description>
  </rule>

  <rule id="130001" level="3">
    <if_sid>130000</if_sid>
    <match>Receiving handshake initiation from peer</match>
    <description>WireGuard: Successful handshake initiated by peer $(id) from $(srcip).</description>
    <group>authentication_success,</group>
  </rule>

  <rule id="130002" level="5">
    <if_sid>130000</if_sid>
    <match>Invalid handshake initiation from</match>
    <description>WireGuard: Invalid handshake attempt from $(srcip).</description>
    <group>authentication_failed,</group>
  </rule>

  <rule id="130003" level="10" frequency="5" timeframe="120">
    <if_matched_sid>130002</if_matched_sid>
    <same_source_ip />
    <description>WireGuard: Multiple invalid handshake attempts from $(srcip). Possible scanning or brute-force attack.</description>
    <mitre>
      <id>T1110</id>
    </mitre>
    <group>authentication_failures,</group>
  </rule>

  <rule id="130004" level="7">
    <if_sid>130000</if_sid>
    <match>Packet has unallowed src IP</match>
    <description>WireGuard: Peer $(id) ($(dstip)) sent a packet with an unallowed source IP $(srcip).</description>
    <group>policy_violation,</group>
  </rule>

  <rule id="130005" level="0">
    <if_sid>130000</if_sid>
    <match>keepalive packet</match>
    <description>WireGuard: Keepalive packet.</description>
  </rule>

  <rule id="130006" level="2">
    <if_sid>130000</if_sid>
    <match>Keypair \d+ created for peer</match>
    <description>WireGuard: New keypair created for peer $(id).</description>
    <group>connection_attempt,</group>
  </rule>

  <rule id="130007" level="2">
    <if_sid>130000</if_sid>
    <match>Keypair \d+ destroyed for peer</match>
    <description>WireGuard: Keypair destroyed for peer $(id).</description>
    <group>connection_end,</group>
  </rule>

</group>
